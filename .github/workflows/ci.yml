name: ci

on:
  push:
    branches:
      - main
  pull_request:

defaults:
  run:
    # NOTE: A bit stricter than the default bash options used by GitHub Actions
    shell: bash --noprofile --norc -euo pipefail {0}

jobs:
  test-determine-stacks:
    name: Test determine-stacks composite action
    runs-on: ubuntu-24.04
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Install uv
        uses: astral-sh/setup-uv@v6

      - name: Run tests
        working-directory: ./determine-stacks
        run: uv run pytest -v

  test-evaluate-automerge:
    name: Test evaluate-automerge composite action
    runs-on: ubuntu-24.04
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Install uv
        uses: astral-sh/setup-uv@d0cc045d04ccac9d8b7881df0226f9e82c39688e # v6

      - name: Run tests
        working-directory: ./evaluate-automerge
        run: uv run python -m unittest -v
