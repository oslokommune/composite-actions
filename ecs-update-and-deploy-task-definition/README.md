# Permissions

Permissions that must be granted to `GITHUB_TOKEN`:

```yml
permissions:
  id-token: write # For the GitHub's OIDC Token endpoint
```

## Images input data structure

```json
{
    "init-container": {
        "imageRepository": "pirates-dev-too-tikki-init",
        "imageDigest": "sha256:0d4626f3160ffcb561926074c0c3305a0faa7955",
        "imageTag": "2025-03-06_16-27-31_main_gha-13703418764_sha-b8a861e"
    },
    "too-tikki": {
        "imageRepository": "pirates-dev-too-tikki-main",
        "imageDigest": "sha256:c5777a8d16b664157b5ac56196f70527f1ce10e1",
        "imageTag": "2025-03-06_16-27-31_main_gha-13703418764_sha-b8a861e"
    }
}
```

<!-- BOILERPLATE BEGIN -->
<!-- Generated by running `make docs` from the project root -->

# Update and deploy ECS task definition

Downloads an existing ECS task definition, updates multiple container image URIs, and optionally deploys the updated task definition to the specified ECS service.

## Usage

### Inputs

|           Input            |                                                                   Description                                                                    |Required|Default |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|--------|--------|
|`aws-region`                |The AWS region to use.                                                                                                                            |yes     |``n/a`` |
|`aws-role-arn`              |The ARN of the IAM role to assume.                                                                                                                |yes     |``n/a`` |
|`cluster-name`              |The name of the ECS service's cluster.                                                                                                            |yes     |``n/a`` |
|`service-name`              |The name of the ECS service to deploy to.                                                                                                         |yes     |``n/a`` |
|`task-definition-name`      |The name of the task definition.                                                                                                                  |yes     |``n/a`` |
|`images`                    |JSON array of containers and images to update in the task definition. See this action's README for the expected format.                           |yes     |``n/a`` |
|`deploy`                    |Deploy the task definition. Can be either "true" or "false".                                                                                      |yes     |``n/a`` |
|`wait-for-service-stability`|Whether to wait for the ECS service to reach stable state after deploying the new task definition. Default "true" Can be either "true" or "false".|no      |``true``|
|`desired-count`             |Optional. Desired number of tasks to run in the service. Leave empty to not override the current service desired count.                           |no      |````    |

### Example

```yaml
- name: Update and deploy ECS task definition
  uses: oslokommune/composite-actions/ecs-update-and-deploy-task-definition@main
  with:
    aws-region: # Required
    aws-role-arn: # Required
    cluster-name: # Required
    service-name: # Required
    task-definition-name: # Required
    images: # Required
    deploy: # Required
    # wait-for-service-stability: # Optional, default: true
    # desired-count: # Optional, default: 
```

## Outputs

|           Name            |                 Description                  |                             Value                             |
|---------------------------|----------------------------------------------|---------------------------------------------------------------|
|`task-definition-file-name`|The path to the rendered task definition file.|``${{ steps.update-task-definition.outputs.task-definition }}``|



<!-- BOILERPLATE END -->